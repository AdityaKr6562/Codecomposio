---
title: "SQL Agent"
sidebarTitle: "SQL Agent"
icon: "database"
description: "This guide provides detailed steps to create an agent that leverages 
Composio to perform SQL queries and file operations to perform sql queries and 
File operations and plot insightful graphs on the data in the db"
---

This project involves setting up and running a system of agents to conduct SQL queries, write the output to a file, and plot graphs based on the data. We use Composio to set up the tools and OpenAI GPT-4 to power the agents. Follow this guide to set up and run the project.

<Card color="#7bee0c" title="SQL Agent GitHub Repository" icon="github" href="https://git.new/SQLAgent">
  Explore the complete source code for the SQL Agent project. This repository contains all the necessary files and scripts to set up and run the SQL Agent system using Langchain and Composio.
  <CardBody>
    - Clone the repository to get started
    - Follow the setup instructions in the README
    - Experiment with and customize the SQL Agent
  </CardBody>
</Card>

<Steps>
    <Step title="Set up the project">
    Clone the repository and install dependencies:
    <CodeGroup>
        ```bash
        git clone https://github.com/your-repo/sql-agent.git
        cd sql-agent
        npm install
        ```
    </Step>

    <Step title="Configure environment variables">
    Create a `.env` file in the project root and add your API keys:
    <CodeGroup>
        ```bash
        COMPOSIO_API_KEY=your_composio_api_key
        OPENAI_API_KEY=your_openai_api_key
        ```
    </CodeGroup>
    </Step>

    <Step title="Imports and Environment Setup">
    In your JavaScript file, import the necessary libraries and set up your environment variables:
    <CodeGroup>
        ```javascript
        import dotenv from 'dotenv';
        import { ChatOpenAI } from "@langchain/openai";
        import { createOpenAIFunctionsAgent, AgentExecutor } from "langchain/agents";
        import { pull } from "langchain/hub";
        import { LangchainToolSet } from "composio-core";

        dotenv.config();
        ```
    </CodeGroup>
    </Step>

    <Step title="Initialize Language Model and Define Tools">
    Initialize the language model with OpenAI API key and model name, and set up the necessary tools for the agents:
    <CodeGroup>
        ```javascript
        const llm = new ChatOpenAI({ 
            model: "gpt-4",
            apiKey: process.env.OPENAI_API_KEY
        });

        const toolset = new LangchainToolSet({ 
            apiKey: process.env.COMPOSIO_API_KEY
        });

        const sqlFileTool = await toolset.get_actions({ 
            actions: ["sqltool_execute_query", "filetool_write"] 
        });

        const allTools = await toolset.get_actions({ 
            actions: ["sqltool_execute_query", "filetool_write", "codeinterpreter_execute_code"] 
        });
        ```
    </CodeGroup>
    </Step>

    <Step title="Define the Task and Execute SQL Query">
    Define the task to execute a SQL query and write the output to a file:
    <CodeGroup>
        ```javascript
        const prompt = await pull("hwchase17/openai-functions-agent");

        const queryTask = "Write sqlite query to get top 10 rows from the only table MOCK_DATA " +
                          "and database companydb using sqltool, write the output in a file called log.txt and return the output";

        const queryAgent = await createOpenAIFunctionsAgent({ llm, tools: sqlFileTool, prompt });
        const agentExecutor = new AgentExecutor({ agent: queryAgent, tools: sqlFileTool, verbose: true });
        const res = await agentExecutor.invoke({ input: queryTask });
        ```
    </CodeGroup>
    </Step>

    <Step title="Define and Execute Code Interpreter Task">
    Create and execute the agent for Code Interpreter operations to plot a graph based on the extracted data:
    <CodeGroup>
        ```javascript
        const codeTool = await toolset.get_actions({ 
            actions: ["codeinterpreter_execute_code"] 
        });

        const codeAgent = await createOpenAIFunctionsAgent({ llm, tools: codeTool, prompt });
        const codeExecutor = new AgentExecutor({ agent: codeAgent, tools: codeTool, verbose: true });

        const plotTask = "Using the following extracted information, plot the graph between first name and salary: " +
                         res.output;

        const finalRes = await codeExecutor.invoke({ input: plotTask });
        ```
    </CodeGroup>
    </Step>

</Steps>

## Putting it All Together
<CodeGroup>
    ```javascript
    import dotenv from 'dotenv';
    import { ChatOpenAI } from "@langchain/openai";
    import { createOpenAIFunctionsAgent, AgentExecutor } from "langchain/agents";
    import { pull } from "langchain/hub";
    import { LangchainToolSet } from "composio-core";

    dotenv.config();

    async function runSQLAgent() {
        const llm = new ChatOpenAI({ 
            model: "gpt-4",
            apiKey: process.env.OPENAI_API_KEY
        });

        const toolset = new LangchainToolSet({ 
            apiKey: process.env.COMPOSIO_API_KEY
        });

        const sqlFileTool = await toolset.get_actions({ 
            actions: ["sqltool_execute_query", "filetool_write"] 
        });

        const allTools = await toolset.get_actions({ 
            actions: ["sqltool_execute_query", "filetool_write", "codeinterpreter_execute_code"] 
        });

        const prompt = await pull("hwchase17/openai-functions-agent");

        const queryTask = "Write sqlite query to get top 10 rows from the only table MOCK_DATA " +
                          "and database companydb using sqltool, write the output in a file called log.txt and return the output";

        const queryAgent = await createOpenAIFunctionsAgent({ llm, tools: sqlFileTool, prompt });
        const agentExecutor = new AgentExecutor({ agent: queryAgent, tools: sqlFileTool, verbose: true });
        const res = await agentExecutor.invoke({ input: queryTask });

        const codeTool = await toolset.get_actions({ 
            actions: ["codeinterpreter_execute_code"] 
        });

        const codeAgent = await createOpenAIFunctionsAgent({ llm, tools: codeTool, prompt });
        const codeExecutor = new AgentExecutor({ agent: codeAgent, tools: codeTool, verbose: true });

        const plotTask = "Using the following extracted information, plot the graph between first name and salary: " +
                         res.output;

        const finalRes = await codeExecutor.invoke({ input: plotTask });

        console.log(finalRes);
    }

    runSQLAgent().catch(console.error);
    ```
</CodeGroup>
